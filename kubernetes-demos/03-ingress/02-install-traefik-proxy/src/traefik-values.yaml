# Traefik Configuration for AWS EKS
# Optimized for Ingress learning with OTel Demo
# Compatible with Traefik Helm Chart v39.x+ (Traefik Proxy v3.x)

# Deployment settings
deployment:
  enabled: true
  kind: Deployment
  replicas: 2

# Service configuration
service:
  enabled: true
  type: LoadBalancer
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"

# Ports / EntryPoints
ports:
  web:
    port: 8000
    expose:
      default: true
    exposedPort: 80
    protocol: TCP
  websecure:
    port: 8443
    expose:
      default: true
    exposedPort: 443
    protocol: TCP
    # TLS enabled by default in v3
  traefik:
    port: 9000
    expose:
      default: false
    exposedPort: 9000
    protocol: TCP

# IngressClass
ingressClass:
  enabled: true
  isDefaultClass: false
  name: traefik

# Providers
providers:
  kubernetesIngress:
    enabled: true
    allowExternalNameServices: false
    allowEmptyServices: false
    publishedService:
      enabled: true
  kubernetesCRD:
    enabled: true
    allowExternalNameServices: false
    allowEmptyServices: false
    allowCrossNamespace: false

# Logs
logs:
  general:
    level: INFO
  access:
    enabled: true
    format: common

# Metrics
metrics:
  prometheus:
    enabled: true
    addEntryPointsLabels: true
    addRoutersLabels: true
    addServicesLabels: true
    entryPoint: metrics
    service:
      enabled: true

# Dashboard
ingressRoute:
  dashboard:
    enabled: true
    matchRule: PathPrefix(`/dashboard`) || PathPrefix(`/api`)
    entryPoints: ["traefik"]

# Resources
resources:
  requests:
    cpu: "100m"
    memory: "50Mi"
  limits:
    cpu: "300m"
    memory: "150Mi"

# Autoscaling disabled
autoscaling:
  enabled: false

# Security Context
securityContext:
  capabilities:
    drop: [ALL]
  readOnlyRootFilesystem: true
  runAsGroup: 65532
  runAsNonRoot: true
  runAsUser: 65532

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1